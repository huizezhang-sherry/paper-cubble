---
title: "5-1-covid"
output: html_document
---

# Applications {#examples}

The five examples here are chosen to illustrate these aspects of the \pkg{cubble} package: creating a \code{cubble} object from two Coronavirus (COVID) data tables with the complication of differing location names, using spatial transformations to make a glyph map of seasonal temperature changes over years, matching river level data and weather station records for analysis of water supply, reading NetCDF format data to reproduce a climate reanalysis plot, and the workflow to create complex interactive linked plots. (The Appendix provides another example on aggregating information spatially to explore precipitation patterns.)



## Victoria COVID spatio-temporal incidence and spread {#covid}

Since the start of the pandemic, the Victoria State Government in Australia has provided daily COVID counts by local government area (LGA). This data can be used to visualize COVID incidence and spread spatially, when combined with map polygon data available from the Australian Bureau of Statistics. These different sources need to be combined for the analysis, by matching the LGA names. Both the COVID count data (\code{covid}) and the LGA information (\code{lga}) are available in the \pkg{cubble} package with the \code{covid} data stored as a \code{tsibble} object, the \code{lga} data as an \code{sf} object.

The \code{make_cubble()} function is used to create a \code{cubble} object from the two spatial and temporal tables as described in Section \@ref(create). The \code{by} argument allows for mismatch of key names from the two tables in the \code{*_join()} \code{by} syntax: 

```{r covid-4, echo = TRUE, warning = TRUE, message= TRUE}
cb <- make_cubble(lga, covid, by = c("lga_name_2018" = "lga"))
```

The warning message reports on the mismatches of location from both sides: there are LGAs in the COVID data that do not match with LGAs names in the spatial polygon data, and vice versa. The \code{make_cubble()} function prompts the use of \code{check_key()} to identify the mismatches:

```{r covid-5, echo = TRUE}
(check_res <- check_key(
  spatial = lga, temporal = covid, 
  by = c("lga_name_2018" = "lga")
))
```

The check result is a list with three elements: 1) matched pairs from both tables, 2) those pairs that can be potentially paired, and 3) others. Here the main mismatch comes from different encodings of two LGAs: Kingston and Latrobe. Analysts can then modify the input spatial and temporal data accordingly and create the cubble again: 

```{r covid-6, echo = TRUE}
lga2 <- lga |>
  rename(lga = lga_name_2018) |> 
  mutate(lga = ifelse(lga == "Kingston (C) (Vic.)", "Kingston (C)", lga),
         lga = ifelse(lga == "Latrobe (C) (Vic.)", "Latrobe (C)", lga)) |>
  filter(!lga %in% check_res$others$spatial) 
  
covid2 <- covid |> filter(!lga %in% check_res$others$temporal)

(cb <- make_cubble(spatial = lga2, temporal = covid2))
```
