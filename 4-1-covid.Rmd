---
title: "5-1-covid"
output: html_document
---

# Applications {#examples}

Five examples are chosen to illustrate different aspects of the \pkg{cubble} package: creating a \code{cubble} object from two Coronavirus (COVID) data tables with the complication of differing location names, using spatial transformations to make a glyph map of seasonal temperature changes, matching river level data and weather station records for analysis of water supply, reading NetCDF format data to reproduce a climate reanalysis plot, and the workflow to create complex interactive linked plots.

## Victoria COVID spatio-temporal incidence and spread {#covid}

Since the start of the pandemic, the Victoria State Government in Australia has been providing daily COVID counts per Logal Government Area (LGA). This data can be combined with map polygon data, available from the Australian Bureau of Statistics (ABS), to visualize COVID incidence and spread. In the \pkg{cubble} package, the COVID count data (\code{covid}) and the LGA information (\code{lga}) are available as a \code{tsibble} object and an \code{sf} object respectively.

A cubble object can be created from separate spatial and temporal component using the \code{make_cubble()} function, introduced in Section \@ref(create). The \code{by} argument
is used to specify the joining variable from the two component using the \code{*_join()} \code{by} syntax: 

```{r covid-4, echo = TRUE, warning = TRUE, message= TRUE}
cb <- make_cubble(lga, covid, by = c("lga_name_2018" = "lga"))
```

The warning message suggests the slight difference of LGA encoding used by Victoria government and ABS and prompts analysts to use the function \code{check_key()} to identify the mismatches:

```{r covid-5, echo = TRUE}
(check_res <- check_key(
  spatial = lga, temporal = covid, 
  by = c("lga_name_2018" = "lga")
))
```

The result of the \code{check_key()} function is a list containing three elements: 1) matched keys from both tables, 2) potentially pairable keys, and 3) others. Here, the main mismatch arises from the two LGAs: Kingston and Latrobe (Kingston is a LGA in both Victoria and South Australia and Latrobe is a LGA in both Victoria and Tasmania). Analysts can modify the input spatial and temporal data accordingly and recreate the cubble object: 

```{r covid-6, echo = TRUE}
lga2 <- lga |>
  rename(lga = lga_name_2018) |> 
  mutate(lga = ifelse(lga == "Kingston (C) (Vic.)", "Kingston (C)", lga),
         lga = ifelse(lga == "Latrobe (C) (Vic.)", "Latrobe (C)", lga)) |>
  filter(!lga %in% check_res$others$spatial) 
  
covid2 <- covid |> filter(!lga %in% check_res$others$temporal)

(cb <- make_cubble(spatial = lga2, temporal = covid2))
```
