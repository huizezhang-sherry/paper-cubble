---
title: "1-intro"
output: pdf_document
---

# Introduction

Spatio-temporal data involves variables observed in the space across time and this paper focuses on spatio-temporal vector data with fixed locations and regular time interval. This type of data can naturally been considered as a data cube with three axes: spatial identifier, temporal identifier, and variable. In this cubic formation, space only occupies one axis, rather than two, to avoid hypercubes for multivariate spatio-temporal data. While conceptually the data format is relatively simple, the data objects coming to the analysts can vary in forms in the analysis. Figure \ref{fig:illu-input} shows three examples of wild spatio-temporal data: 1) a single table that includes both the spatial and temporal variables; 2) separate tables for spatial and temporal variables; 3) array-based data, i.e. NetCDF (Network Common Data Form) data, which is commonly used in earth science, e.g. climatology, meteorology, and oceanography, among others, to organise multivariate data in a spatio-temporal grid.

```{r illu-input, echo = FALSE, out.width = "100%", fig.cap="An illustration of different spatio-temporal data layout: (1) a single table for both spatial and temporal variables; (2) separate tables for spatial and temporal variables; and (3) an array data structure that populates variables into a gridded longitude-latitude-time (hyper)cube.", fig.align='center'}
knitr::include_graphics(here::here("figures/diagram-keynotes/diagram-keynotes.001.png"))
```


<!-- Manipulating data in these two levels is usually done separately and the third tidy data principal [@tidydata] recommends each type of observational unit to form a table. Another feature for a spatio-temporal data structure to have is that variables created from subsequent operations can be automatically added to the existing table with the same level. This is better than an output that index the variables with the identifiers since otherwise analysts will need to manually join this output with existing variables in the same level. -->

<!-- Many data structures have been proposed for spatial (\pkg{sf} by @sf) and temporal (\pkg{tsibble} by @tsibble) data in the R community, while less has been done for spatio-temporal data. The lack of such tools could potentially because analysts usually treat the spatial and temporal dimension of the data separately, without realising the need to create a new data structure. While this approach follows the third tidy data principal [@tidydata] (*Each type of observational unit forms a table*), analysts always need to manually join results from different observational units or combining multiple tables into one for downstream analysis. This additional step doesn't add new operations into the data but can be error prone. \newline -->

While the data is enriched the information in both the spatial and temporal dimension, it also brings variables in two different observational units, which poses the problem of organising data for various operations in exploratory data analysis, visualisation, and modelling. The single table format is convenient for spatio-temporal operations, however, it makes duplicates of spatial variables and is not convenient for spatial operations. The two tables format allows separate spatial and temporal operations on each table while analysts need to work with two data objects simultaneously and dedicate efforts to make sure the sites in both tables are matched up. This data organising issue can also raise during the analysis, for example, a spatial summary of the temporal or spatio-temporal data naturally introduces an additional spatial table and makes the data in the separate table format. With the current tools, at each step, analysts need to decide on the format to operate on, perform the operation, and organise the result with existing data. 

<!-- This would require analysts to constantly switch among different format at each step. All these difficulties are rooted in the two different observational units of spatial and temporal variables and this poses difficulties to organise spatio-temporal data in a way that operates both on a single spatial or temporal dimension and the combined spatio-temporal dimension. -->

<!-- None of these three formats in Figure \ref{fig:illu-input} is not particularly convenient to work with. In the single table format, to avoid plotting duplicated points of the same sites on the map, analysts always need to create a spatial variables table from the original single table. This can be a tedious step if needs to performed many times during the analysis. In another type of operation that filter the sites based on certain statistics, intermediate objects, like the per-station summary of the statistic and the filtered station ID vector, will need be created as standalone objects in the environment. The spirit of using pipe reduces the intermediate data objects that are unnecessarily created in the analysis while in this case, these only-used-once data objects can hardly be incorporated into a piping workflow in the analysis. In addition, if the data is organised as a separate spatial and temporal table as format 2 in Figure \ref{fig:illu-input}, the filter on site ID will need to performed twice in each table to keep them both up-to-date. With the array data structure, although it can easily store and wrangle large spatio-temporal data, the 3D or higher-D array can be less intuitive than a 2D tabular data structure for some analysts in data wrangling. -->

In the \proglang{R} community, different data objects have been proposed to work with spatio-temporal data when the specific task is known, while few have the capability to freely explore the data for exploratory data analysis. \pkg{spacetime} [@spacetime] is built on class \pkg{sp} [@sp] and \pkg{xts} [@xts] and both of which have been replaced by more recent spatial and temporal data objects. A more implementation, \pkg{stars} [@stars], uses a spatio-temporal array for wrangling both vector and raster data, but for raw data already in tabular format, need to convert the data into the array structure, also convert at vis. While there has not yet been a data object that makes it easy to explore spatio-temporal data that overcomes the difficulties of wrangling spatio-temporal data, this motivates developing a new tool that hopefully can solve this problem. The requirement for such a tool is important given the ubiquity of spatio-temporal vector data in the wild: climate observations from weather stations, air quality variables from air monitoring stations, or any data collected at fixed location across time. The requirement can also comes from spatial data analysts wanting to incorporate a temporal dimension in their data or vice versa.

This paper proposes an \proglang{R} package, \pkg{cubble}, for exploratory data analysis in spatio-temporal data. The proposed new data structure, also called \code{cubble}, overcomes the inconvenience in data wrangling mentioned above through wiring the separate spatial and temporal table into a single data object. With the new data object, analysts can spend less time organising spatial and temporal variables and focus more on the exploratory data analysis itself. The software is available from the Comprehensive R Archive Network (CRAN) at [CRAN link]. 

The rest of the paper is divided as follows: Section 2 presents the main design and functionality of \pkg{cubble}. Section 3 explains how cubble deals with more advanced considerations including data with hierarchical structure, data matching, how cubble fits with existing static and interactive visualisation tools, and spatio-temporal data transformation. Section 4 uses Australia weather station data and river level data as examples to demonstrate the use with \pkg{cubble}. An example on how \pkg{cubble} handles NetCDF data is also provided. Section 5 concludes the paper.

