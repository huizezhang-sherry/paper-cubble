---
title: "1-intro"
output: pdf_document
---

# Introduction

Spatio-temporal data concerns variables observed in the space across time and this paper focuses on the spatio-temporal vector data with fixed locations and regular time interval. This type of data can naturally been considered as a data cube and here a cube with three axes: spatial identifier, temporal identifier, and variable can be used to conceptualise spatio-temporal data. In this cubic formation, space only occupy one dimension, rather than two, to avoid the needs of hypercube for multivariate spatio-temporal data. While conceptually the data format is relatively simple, the actual data object that comes to the analysts in the analysis can be in various forms. Figure \ref{fig:illu-input} shows four examples of wild spatio-temporal data: 1) combines the time invariant and varying variables into a single table through duplicating the time invariant variables; 2) splits those variables into a separate spatial table and a temporal table; 3) ...; and lastly 4) is array-based data, like NetCDF (Network Common Data Form) data, which is commonly used in earth science, e.g. climatology, meteorology, and oceanography, among others, to organise multivariate data in a spatio-temporal grid.

```{r illu-input, echo = FALSE, out.width = "100%", fig.cap="An illustration of different spatio-temporal data format: (1) a single table for all the variables; (2) separate tables for spatial and temporal variables; (3) a table of metadata used to query the database and a separate table for queried data; and (4) an array data structure.", fig.align='center', out.height = "40%"}
knitr::include_graphics(here::here("figures/diagram-keynotes/diagram-keynotes.001.png"))
```


<!-- Manipulating data in these two levels is usually done separately and the third tidy data principal [@tidydata] recommends each type of observational unit to form a table. Another feature for a spatio-temporal data structure to have is that variables created from subsequent operations can be automatically added to the existing table with the same level. This is better than an output that index the variables with the identifiers since otherwise analysts will need to manually join this output with existing variables in the same level. -->

<!-- Many data structures have been proposed for spatial (\pkg{sf} by @sf) and temporal (\pkg{tsibble} by @tsibble) data in the R community, while less has been done for spatio-temporal data. The lack of such tools could potentially because analysts usually treat the spatial and temporal dimension of the data separately, without realising the need to create a new data structure. While this approach follows the third tidy data principal [@tidydata] (*Each type of observational unit forms a table*), analysts always need to manually join results from different observational units or combining multiple tables into one for downstream analysis. This additional step doesn't add new operations into the data but can be error prone. \newline -->

Different authors have proposed various data objects to work with spatial temporal data in \proglang{R}. \pkg{spacetime} [@spacetime] is built on the \pkg{sp} [@sp] and \pkg{xts} [@xts] class and both of which have been replaced by more recent spatial and temporal data objects. \pkg{spatstat} [@spatstat] implements a `ppp` class for analysing point pattern data; and more recent, \pkg{stars} [@stars] has implemented an spatio-temporal array for wrangling both vector and raster data. 

None of these three formats in Figure \ref{fig:illu-input} is not particularly convenient to work with. To augment a one-site-per-row summary with the original spatial variables in a single table format (example 1 in Figure \ref{fig:illu-input}), analysts will need to first make a distinct one-site-per-row summary of the original spatial variables before the join. This step adds few value to the analyais but is a tedious step that first select all the spatial variables and then find the distinct row of each. In another type of operation that filter the sites based on per-site summary, intermediate objects, like the per-station summary and the filtered station id vector, will need be created as standalone objects in the environment. The spirit of using pipe reduces the intermediate data objects that are unnecessarily created in the analysis while in this case, these only-used-once data objects are hard to be incorporated into a piping workflow. In addition, if the data is organised as a separate spatial and temporal table as example 2 in Figure \ref{fig:illu-input}, the filter on site ID will need to performed twice in each table to keep them both up-to-date. With the array data structure, although it can easily store and wrangle large spatio-temporal data, the 3D or higher array can be less intuitive than a 2D tabular data in data wrangling. 

Data objects like \pkg{sf} [@sf] and \pkg{tsibble} [@tsibble] have smoothed the data analysis in spatial or temporal data analysis, while there has not yet been a spatio-temporal data structure that makes it easy to explore spatio-temporal data and this creates a gap in the software development. The requirement for such a tool is important given the ubiquity of spatio-temporal vector data in the wild: climate observations from weather stations, air quality variables from air monitoring stations, or any variables that are measured at fixed location across time.

<!-- While these implementations either store spatial and temporal variables all in a single table, hence duplicate the spatial variables at each temporal unit; or split them into two separate tables that analysts need to manually join the data constantly when doing the analysis. \textcolor{red}{There has been data structure proposed for spatial (\pkg{sf} by @sf) and temporal (\pkg{tsibble} by @tsibble) data in the R community, while less has been done for spatio-temporal data.}  -->

This paper describes the a new tabular data object:  \pkg{cubble} for wrangling spatio-temporal data. \pkg{Cubble} overcomes the inconvenience in data wrangling mentioned above through two forms: a nested form to organise spatial variables and a long form to organise temporal variables. With this structure, analysts can explore the spatio-temporal data with less efforts spend on organising variables at different observational units. The software is available from the Comprehensive R Archive Network (CRAN) at [CRAN link]. 

The rest of the paper is divided as follows: Section 2 presents the workflow of data manipulation in cubble. Section 3 explains how cubble deals with some advanced considerations  including data with hierarchical structure, data matching, and how cubble fits with existing static and interactive visualisation tools. Section 4 gives examples of the features introduced in the previous two sections with climate and hydrology data. An example on how cubble handle NetCDF data is also provided. Section 5 concludes the paper.

